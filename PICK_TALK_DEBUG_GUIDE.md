# 🔍 픽톡 디버깅 시스템 가이드

**작성일:** 2025-08-27
**대상:** 픽톡 AI 채팅 시스템 전체 플로우
**목적:** 모든 동작에 대한 상세 디버깅 및 모니터링

---

## 📋 디버깅 시스템 개요

픽톡의 모든 주요 컴포넌트에 체계적인 디버깅 로그를 추가하여 실시간 모니터링과 문제 추적이 가능하도록 구성했습니다.

### 🎯 주요 특징
- ⏱️ **성능 측정**: 모든 주요 작업의 소요 시간 측정
- 🔍 **상세 로깅**: 각 단계별 상태와 데이터 추적
- 🚨 **에러 추적**: 에러 ID를 통한 체계적인 오류 관리
- 📊 **세션 모니터링**: 사용자 세션과 대화 히스토리 추적
- 🎨 **시각적 구분**: 이모지와 색상을 통한 로그 가독성 향상

---

## 🏗️ 구현된 디버깅 영역

### 1. 🖥️ **백엔드 API 라우터** (`backend/routers/pick_chatbot.py`)

#### 메인 채팅 엔드포인트
```python
@router.post("/chat", response_model=ChatResponse)
async def chat_with_help_bot(...)
```

**디버깅 정보:**
- 📝 요청 정보 (세션 ID, 메시지, 시간)
- 🧹 세션 정리 소요 시간
- 🔑 세션 관리 처리 시간
- 💾 메시지 저장 시간
- 🧠 컨텍스트 로딩 시간 및 내용
- 🎯 의도 분류 결과 및 소요 시간
- ⚡ 병렬 처리 완료 시간
- 📊 최종 응답 생성 시간

**로그 예시:**
```
================================================================================
🚀 [PICK-TALK DEBUG] 채팅 요청 시작
📝 세션 ID: session_12345
💬 사용자 메시지: 'React 개발자 채용'
🕐 요청 시각: 2025-08-27 16:54:18
================================================================================
🧹 [세션 정리] 완료 (소요시간: 0.001초)
🔑 [세션 관리] 세션 ID: session_12345 (소요시간: 0.002초)
💾 [메시지 저장] 사용자 메시지 저장 완료 (소요시간: 0.001초)
🧠 [컨텍스트] 컨텍스트 로드 완료 (소요시간: 0.003초)
    📋 컨텍스트 키워드: ['채용', '개발']
    📜 최근 메시지 수: 5개
🎯 [의도 분류] 채용공고 의도: True (소요시간: 0.005초)
🚀 [채용공고 처리] 병렬 채용공고 에이전트 실행 시작
⚡ [병렬 처리] 완료 (소요시간: 2.450초)
📊 [병렬 결과] 타입: job_info_extracted_navigate
```

### 2. 🤖 **채용공고 에이전트** (`backend/modules/job_posting/parallel_job_posting_agent.py`)

**디버깅 정보:**
- 📝 에이전트 처리 시작 정보
- 🎯 의도 분류 결과 및 소요 시간
- ❌ 비채용공고 요청 감지
- 🚀 병렬 처리 시작/완료 알림

**로그 예시:**
```
============================================================
🤖 [JOB-AGENT DEBUG] 채용공고 에이전트 처리 시작
📝 세션 ID: session_12345
💬 사용자 메시지: 'React 개발자 채용'
🕐 처리 시각: 2025-08-27 16:54:18
============================================================
🎯 [의도 분류] 결과: True (소요시간: 0.002초)
```

### 3. 🔑 **세션 관리** (`SessionManager` 클래스)

**디버깅 정보:**
- 🔑 새 세션 생성 정보
- 💬 메시지 추가 상세 정보
- 📚 히스토리 정리 내역
- 📊 활성 세션 수 추적

**로그 예시:**
```
🔑 [SESSION DEBUG] 새 세션 생성
    📝 세션 ID: session_12345
    ⏰ 생성 시간: 1693132458
    📊 총 활성 세션 수: 3

💬 [SESSION DEBUG] 메시지 추가
    📝 세션 ID: session_12345
    👤 역할: user
    📄 내용 길이: 15자
    📊 히스토리: 4 → 5개

📚 [SESSION DEBUG] 히스토리 정리: 2개 메시지 제거
```

### 4. 🌐 **프론트엔드 컴포넌트** (`frontend/src/components/NewPickChatbot.js`)

**디버깅 정보:**
- 🚀 메시지 전송 프로세스 시작
- 📝 전송 메시지 상세 정보
- 🌐 API 호출 및 응답 시간
- 📦 응답 데이터 분석
- 🏁 전체 프로세스 완료 시간

**로그 예시:**
```
🚀 [PICK-TALK FRONTEND] 메시지 전송 프로세스
📝 전송 메시지: React 개발자 채용
⏰ 시작 시간: 16:54:18
🔢 메시지 길이: 15
📊 현재 메시지 수: 8개
👤 사용자 메시지 객체: {id: 1693132458, text: "React 개발자 채용", ...}
🔄 UI 상태 업데이트 완료 (메시지 추가, 입력창 초기화, 로딩 시작)
🌐 API 호출 시작...
✅ API 응답 수신 완료
⏱️ API 응답 시간: 2456ms
📦 응답 데이터: {response: "...", status: "success", ...}
🎯 응답 타입: object
📏 응답 크기: 1247 bytes
🏁 [PICK-TALK FRONTEND] 메시지 전송 프로세스 완료
⏱️ 전체 처리 시간: 2458ms
📊 최종 메시지 수: 10개
🎯 로딩 상태 해제
```

### 5. 🚨 **에러 핸들링 및 예외 처리**

#### 백엔드 에러 처리
```python
except Exception as e:
    total_time = time.time() - start_time
    error_id = f"ERR_{int(time.time())}"

    print(f"🚨 [CRITICAL ERROR] 픽톡 처리 중 심각한 오류 발생")
    print(f"🆔 에러 ID: {error_id}")
    print(f"📝 세션 ID: {chat_message.session_id}")
    print(f"💬 사용자 메시지: '{chat_message.message}'")
    print(f"⏱️ 총 처리 시간: {total_time:.3f}초")
    print(f"🔍 에러 타입: {type(e).__name__}")
    print(f"📄 에러 메시지: {str(e)}")
```

#### 프론트엔드 에러 처리
```javascript
console.group('🚨 [PICK-TALK ERROR] API 오류 발생');
console.error('❌ 에러 객체:', error);
console.error('🔍 에러 타입:', error.constructor.name);
console.error('📄 에러 메시지:', error.message);
console.error('🌐 네트워크 상태:', navigator.onLine ? '온라인' : '오프라인');
console.error('⏱️ 요청 처리 시간:', `${totalTime}ms`);
```

---

## 🔍 디버깅 로그 활용 방법

### 1. **개발 환경에서 모니터링**
- 브라우저 개발자 도구 콘솔에서 실시간 로그 확인
- 백엔드 서버 콘솔에서 API 처리 과정 모니터링

### 2. **성능 분석**
- 각 단계별 소요 시간을 통한 병목 지점 식별
- API 응답 시간과 전체 처리 시간 비교

### 3. **에러 추적**
- 고유 에러 ID를 통한 문제 추적
- 상세한 에러 컨텍스트 정보 활용

### 4. **사용자 경험 개선**
- 세션별 대화 흐름 분석
- 의도 분류 정확도 모니터링

---

## 📊 로그 레벨 및 카테고리

### 🎯 **카테고리별 이모지 구분**
- 🚀 **시작/완료**: 프로세스 시작과 완료
- 📝 **데이터**: 입력 데이터와 메시지 정보
- ⏱️ **성능**: 처리 시간과 성능 지표
- 🔑 **세션**: 세션 관리 관련 정보
- 🎯 **의도**: 의도 분류 및 AI 판단
- 🌐 **네트워크**: API 호출과 응답
- 🚨 **에러**: 오류 및 예외 상황
- 📊 **통계**: 수치와 통계 정보

### 📋 **로그 우선순위**
1. **CRITICAL** (🚨): 시스템 중단을 야기하는 심각한 오류
2. **ERROR** (❌): 기능 실행 실패
3. **WARNING** (⚠️): 잠재적 문제 상황
4. **INFO** (ℹ️): 일반적인 정보
5. **DEBUG** (🔍): 상세한 디버깅 정보

---

## 🎛️ 디버깅 설정 제어

### 환경별 로그 레벨 조정
```javascript
// 개발 환경에서만 상세 로그 출력
const DEBUG_MODE = process.env.NODE_ENV === 'development';

if (DEBUG_MODE) {
  console.log('🔍 [DEBUG] 상세 디버깅 정보');
}
```

### 선택적 로그 활성화
```python
# 백엔드에서 특정 모듈만 디버깅
DEBUG_MODULES = ['session', 'job_agent', 'api']

if 'session' in DEBUG_MODULES:
    print(f"🔑 [SESSION DEBUG] 세션 정보")
```

---

## 🚀 향후 확장 계획

1. **로그 수집 시스템**: ELK Stack 또는 클라우드 로깅 서비스 연동
2. **실시간 모니터링**: 대시보드를 통한 실시간 시스템 상태 모니터링
3. **알림 시스템**: 임계값 초과 시 자동 알림 발송
4. **성능 메트릭**: 상세한 성능 지표 수집 및 분석
5. **사용자 행동 분석**: 대화 패턴과 사용자 만족도 분석

---

## 📞 문의 및 지원

디버깅 시스템 관련 문의사항이나 개선 제안이 있으시면 개발팀에 연락해주세요.

**디버깅 시스템이 성공적으로 구축되었습니다!** 🎉
